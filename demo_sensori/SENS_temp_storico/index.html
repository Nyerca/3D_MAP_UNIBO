<!DOCTYPE html>
<html lang="en" >

<head>
  <meta charset="UTF-8">
  <title>Area Chart (displays nodes on hover) </title>
  <link href="https://fonts.googleapis.com/css?family=Poppins" rel="stylesheet">


  
</head>

<body>

  <!-- https://dribbble.com/shots/3654725-Transparency-area-chart/attachments/816929 -->
<div id="myChart"></div>
  <script src='https://cdn.zingchart.com/zingchart.min.js'></script>

    <script src='http://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js'></script>
  <script src="//code.jquery.com/ui/1.11.2/jquery-ui.js"></script>
<script src = "/socket.io/socket.io.js"></script>
    <script>
		// Chart Data
var avg_tin = [0,0,0,0,0,0,0];
var avg_tout = [3, 3, 4, 7, 4, 3, 3];


	var day0, day1, day2, day3, day4, day5, day6;
	for(var i= 0; i < 7; i++) {
var day = new Date();
day.setDate(day.getDate() - i);

var month_n = day.getUTCMonth() + 1; //months from 1-12
var day_n = day.getUTCDate();
var year_n = day.getUTCFullYear();
var day = year_n
if(("" + month_n).length == 1) {
day += "-0" + month_n
} else {
day += "-" + month_n
}
if(("" +day_n).length == 1) {
day += "-0" + day_n
} else {
day += "-" + day_n
}

switch(i) {
	case 0: day0 = day; break;
	case 1: day1 = day; break;
	case 2: day2 = day; break;
	case 3: day3 = day; break;
	case 4: day4 = day; break;
	case 5: day5 = day; break;
	case 6: day6 = day; break;
}

}

	$(document).ready(function() {
	//console.log("" + day0 + "   " + day1+ "   " + day2+ "   " + day3+ "   " + day4+ "   " + day5+ "   " + day6);
	var socket = io('/mySensorNamespace');	
	socket.on('hi',function(data) {	

		var valori = data.str.split(';');
		for(var field in valori) {
			var line = valori[field].split('***');

			if(line[2] == '1') {
						//console.log(line[0]);
				var d = new Date("" + line[1]);
				var str = $.datepicker.formatDate('yy-mm-dd', d);
				if(str === day0) {
					avg_tin[0] = parseFloat(line[0]);
				} else if(str == day1) {
					avg_tin[1] = parseFloat(line[0]);
				} else if(str == day2) {
					avg_tin[2] = parseFloat(line[0]);
				} else if(str == day3) {
					avg_tin[3] = parseFloat(line[0]);
				} else if(str == day4) {
					avg_tin[4] = parseFloat(line[0]);
				} else if(str == day5) {
					avg_tin[5] = parseFloat(line[0]);
				} else if(str == day6) {
					avg_tin[6] = parseFloat(line[0]);
				}
			}
			//console.log(avg_tin);
		}
		
		var valori = data.max.split(';');
		/*for(var field in valori) {
			console.log(valori[field]);
		}*/
		
		var valori = data.min.split(';');
		/*for(var field in valori) {
			console.log(valori[field]);
		}*/
		
		
		
// Chart Configuration
var chartData = {
  type: "area",
  globals: {
    fontFamily: "Poppins",
    fontColor: "#333"
  },
  title: {
    text: "Government requests by volume",
    align: "center",
    padding: "5px"
  },
  subtitle: {
    text:
      "This area graph shows the total number of requests recieved over time, broken down by request type",
    align: "center",
    fontColor: "#505050",
    padding: "10px"
  },
  legend: {
    align: "center",
    verticalAlign: "bottom",
    layout: "3x2",
    border: "none",
    item: {
      fontSize: "18px"
    },
    marker: {
      type: "circle"
    }
  },
  plot: {
    aspect: "spline"
  },
  gui:{
    behaviors:[ //default contextMenu behaviors
        {
          id: "Reload", //built-in id
          enabled:"none" //sets visibility to show 
        },
        {
          id: "SaveAsImage",
          enabled:"none"
        },
        {
          id: "DownloadPDF", //built-in id
          enabled: "none" //sets visibility to show
        },
        {
          id: "DownloadSVG",
          enabled: "none"
        },
        {
          id: "Print", 
          enabled: "none"
        },
        {
          id: "ViewSource", //built-in id 
          enabled: "none" //sets visibility to hide
        },
		{
          id: "HideGuide", //built-in id 
          enabled: "none" //sets visibility to hide
        }
      ] 
  },
  scaleX: {
    labels: [
      "Jul 16",
      "Aug 16",
      "Sep 16",
      "Oct 16",
      "Nov 16",
      "Dec 16",
      "Jan 17"
    ]
  },
  crosshairX:{
      lineColor: "#565656",
      lineStyle: "dashed",
      lineWidth: 2,
      alpha : 0.5,
      plotLabel:{ //label assoicated to data points
   	    backgroundColor : "#ffffff",
  	    borderColor : "#d2d2d2",
  	    borderRadius : "5px",
  	    bold : true,
  	    fontSize : "12px",
  	    fontColor : "#111",
  	    shadow : true,
  	    shadowDistance : 2,
  	    shadowAlpha : 0.4
      },
	  scaleLabel:{ //label associated to scaleX index
  	    bold : true,
  	    backgroundColor : "#787878",
  	    borderRadius : 3,
  	    fontColor : "#eaeaea",
  	    fontSize : "12px",
  	    callout : true,
  	    paddingTop : 2
      }
	  },
  scaleY: {
    values: "-10:16:2",
	guide: {
          visible: false
        }
  },
  series: [
    {
      values: avg_tin,
      text: "US Requests",
    },
    {
      values: avg_tout,
      text: "Government Requests",
      
    }
  ]
};

// Render Method
zingchart.render({
  id: "myChart",
  data: chartData,
  height: 500, 
	width: '100%'
});
	});
	
	
	});
	


	
	</script>




</body>

</html>
